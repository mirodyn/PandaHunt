@page "/puzzleB"
@inject PuzzleTimers timers

@if (timers.PuzzleBOpened)
{

    <div class="opened">
        <div class="container">
        <h1>大同县胡东</h1>
        <img width="200" alt="xmarksthespot" src="img/xmarksthespot.png"/>

        </div>

        <EditForm Model="@this">
            <InputNumber @bind-Value="AnswA" step="0.001" ></InputNumber>
            <InputNumber @bind-Value="AnswB" step="0.001"></InputNumber>
            <br/>
            <br/>
            <button type="submit" class="btn-primary form-btn" @onclick="CheckAnswer">Odeslat odpověď</button>
        </EditForm>
    </div>
}
else
{
    <div class="closed">
        <svg id="lock" viewBox="0 0 330 330">
    <g id="XMLID_509_">
	<path id="XMLID_510_" d="M65,330h200c8.284,0,15-6.716,15-15V145c0-8.284-6.716-15-15-15h-15V85c0-46.869-38.131-85-85-85
		S80,38.131,80,85v45H65c-8.284,0-15,6.716-15,15v170C50,323.284,56.716,330,65,330z M180,234.986V255c0,8.284-6.716,15-15,15
		s-15-6.716-15-15v-20.014c-6.068-4.565-10-11.824-10-19.986c0-13.785,11.215-25,25-25s25,11.215,25,25
		C190,223.162,186.068,230.421,180,234.986z M110,85c0-30.327,24.673-55,55-55s55,24.673,55,55v45H110V85z"/>
</g>
</svg>
        <h3>Puzzle B bude odemčen za: </h3>

        <h1>@Time</h1>
    </div>
    
}

@code {
    private string Time = "";
    private static System.Timers.Timer aTimer;
    private int counter = 60;

    public void StartTimer()
    {
        counter = (int)timers.PuzzleBTime.Subtract(DateTime.Now).TotalSeconds;
        aTimer = new System.Timers.Timer(1000);
        aTimer.Elapsed += CountDownTimer;
        aTimer.Enabled = true;
    }

    public async void CountDownTimer(Object source, System.Timers.ElapsedEventArgs e)
    {
        if (counter > 0)
        {
            counter -= 1;
            await InvokeAsync(() =>
            {
                Time = TimeSpan.FromSeconds(counter).ToString(@"dd\:hh\:mm\:ss");
                StateHasChanged();
            });
        }
        else
        {
            await InvokeAsync(() =>
            {
                StateHasChanged();
            });
        }
    }

    protected override void OnAfterRender(bool firstRender)
    {
        if (firstRender && !timers.PuzzleBOpened)
        {
            StartTimer();
        }
    }




    //puzzle


    string text = "大同县胡东";
    private string solution1 = "39.973675";
    private string solution2 = "113.484598";

    public string AnswA;
    public string AnswB;

    private bool Solved = false;
    private bool WrongAnwer = false;

    private void CheckAnswer()
    {

        AnswA = AnswA.Replace(",", ".").Substring(0, 6);
        AnswB = AnswB.Replace(",", ".").Substring(0,7);

        if (AnswA == solution1 && AnswB == solution2)
        {
            Solved = true;
        }
        else
        {
            Solved = false;
            WrongAnwer = true;
        }
    }


}
